<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset='utf-8'> 
	<title>GMusic</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/bootstrap.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<div class="container">
			<h1>GMusic <span class="glyphicon glyphicon-music"></span></h1>
			<br>
			<div class="input-group" id="busqueda"> 
				<input class="form-control" type="text" id="name_song" name="name_song">
				<span class="input-group-btn"><button id="search" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span> Buscar</button></span>
			</div>
		<br>

		<div class="panel panel-primary">
		  <!-- Default panel contents -->
		<div class="panel-heading"><h3>Resultados</h3></div>
		<div class="panel-body">
			<div style="width: 50px; margin: 0 auto;" id="load">
				<img src="{{STATIC_URL}}img/cargar.gif">
			</div>
			<div id="messages">
			</div>
		</div>
		<table class="table table-striped">
			<thead>
			<tr>
				<th><h4><span class="label label-info">Nombre</span></h4></th>
				<th><h4><span class="label label-info">Artista</span></h4></th>
				<th><h4><span class="label label-info">Duracion</span></h4></th>
				<th><h4><span class="label label-info">Calidad</span></h4></th>
				<th><h4><span class="label label-info"></span></h4></th>
			</tr>
			</thead>
			<tbody id="content_table">

			</tbody>
		</table>
		<footer style="text-align: right;" class="panel-footer">Powered by: Django 2013 | <a target="blank_" href="http://github.com/irvingprog">@irvingprog</a></footer>
		</div>
	</div>


<script src="{{STATIC_URL}}js/jquery-1.8.2.js"></script>

<script>
function show_results(song) {
	$.getJSON("{%url 'buscar_cancion_json'%}?name_song="+song.replace(/\s/g,"-"), function() {
		$('#messages').hide();
		$('#content_table').html('');
	})

	.done(function(data) {
		console.log("mostrando datos");
		if (data == 'null') {
			console.log("No se encontraron resultados");
			$('#messages').append('<div class="alert alert-danger">No se encontraron resultados</div>');
			$('#messages').show();
			$('#load').hide();
		}
		else {
			for(var i = 0; i<data.length;i++) {
				var file = $('<tr>');
				var nicon = $('<span class="glyphicon glyphicon-music">').text(" "+data[i].name);
				var name = $('<td>').append(nicon);

				var artist = $('<td>').text(data[i].artist)
				var len = $('<td>').text(data[i].len +' minutos')
				var quality = $('<td>').text(data[i].quality +' kbps')

				var textspan = $('<span class="glyphicon glyphicon-save">').text(" DESCARGAR")
				var button = $('<button class="btn btn-success">').append(textspan)
				var link = $('<a href=\"http://www.goear.com/action/sound/get/'+data[i].id 
					+'\" download=\"'+data[i].name +' - '+ data[i].artist +'\">').append(button)
				var download = $('<td>').append(link)
				$(file).append(name, artist, len, quality, download)
				$('#content_table').append(file)
			}

			$('#load').hide();
		}
	})

	.fail(function() {
		console.log("error");
		$('#messages').append('<div class="alert alert-danger">Ocurri√≥ un problema, Vuelve a realizar la busqueda</div>');
	});
}

$(document).ready(function(){
	$('#search').click(function(){
	    show_results($('#name_song').val());
	    $('#load').show();
	    $('#messages').hide();
	});

	$('#load').hide();
	$('#messages').hide();
});
</script>

<script src="{{STATIC_URL}}js/bootstrap.min.js"></script>
</body>
</html>