<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset='utf-8'> 
	<title>GMusic</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/bootstrap.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<!-- Github badge forkme -->
	<a href="https://github.com/irvingprog/gmusic"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>	
	<!-- End Github badge forkme -->
	<div class="container">
			<div class="row show-grid">
				<div class="col-md-6" style="margin-top: 20px">
					<h1>GMusic <span class="glyphicon glyphicon-music"></span></h1>
					<div class="input-group" id="busqueda"> 
						<input class="form-control" type="text" id="name_song" name="name_song">
						<span class="input-group-btn"><button id="search" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span> Buscar</button></span>
					</div>
				</div>
				<div class="col-md-6 text-center">
					<h3>Ultimas busquedas</h3>
					<div id="ultimas_busquedas" class="alert alert-info">
						{%for item in recent_searchs%}
						<p>{{item.name}}</p>
						{%endfor%}
					</div>
				</div>
			</div>
		<div class="panel panel-primary">
		  <!-- Default panel contents -->
		<div class="panel-heading"><h3>Resultados</h3></div>
		<div class="panel-body">
			<div style="width: 50px; margin: 0 auto;" id="load">
				<img src="{{STATIC_URL}}img/cargar.gif">
			</div>
			<div id="messages">
			</div>
		</div>
		<table class="table table-striped">
			<thead>
			<tr>
				<th><h4><span class="label label-info">Nombre</span></h4></th>
				<th><h4><span class="label label-info">Artísta</span></h4></th>
				<th><h4><span class="label label-info">Duración</span></h4></th>
				<th><h4><span class="label label-info">Calidad</span></h4></th>
				<th><h4><span class="label label-info"></span></h4></th>
			</tr>
			</thead>
			<tbody id="content_table">

			</tbody>
		</table>
			<footer class="panel-footer text-right">Powered by: Django 2013 | <a target="blank_" href="http://github.com/irvingprog">@irvingprog</a> | <a href="https://github.com/irvingprog/gmusic">Github</a></footer>
		</div>
		<p class="alert alert-info text-center">Aviso: GMusic está pensada para descargar sonidos de goear que tu mismo has subido y quieres recuperar.</p>
	</div>

<script src="{{STATIC_URL}}js/jquery-1.8.2.js"></script>

<script>
function show_results(song) {
	$.getJSON("{%url 'buscar_cancion_json'%}?name_song="+song.replace(/\s/g,"-"), function() {
		$('#messages').hide();
		$('#content_table').html('');
	})

	.done(function(data) {
		console.log("mostrando datos");
		if (data == null) {
			console.log("No se encontraron resultados");
			$('#messages').append('<div class="alert alert-danger">No se encontraron resultados</div>');
			$('#messages').show();
			$('#load').hide();
		}
		else {
			for(var i = 0; i<data.length;i++) {
				var file = $('<tr>');
				var nicon = $('<span class="glyphicon glyphicon-music">').text(" "+data[i].name);
				var name = $('<td>').append(nicon);

				var artist = $('<td>').text(data[i].artist)
				var len = $('<td>').text(data[i].len +' minutos')
				var quality = $('<td>').text(data[i].quality +' kbps')

				var textspan = $('<span class="glyphicon glyphicon-save">').text(" DESCARGAR")
				var button = $('<button class="btn btn-success">').append(textspan)
				var link = $('<a href=\"http://www.goear.com/action/sound/get/'+data[i].id 
					+'\" download=\"'+data[i].name +' - '+ data[i].artist +'\">').append(button)
				var download = $('<td>').append(link)
				$(file).append(name, artist, len, quality, download)
				$('#content_table').append(file)
			}

			$('#load').hide();
		}
	})

	.fail(function() {
		console.log("error");
		$('#messages').append('<div class="alert alert-danger">Ocurrió un problema, Vuelve a realizar la busqueda</div>');
	});
}

function show_recent_searchs() {
	$.getJSON("{%url 'ultimas_cancones_json'%}", function() {
		$('#ultimas_busquedas').html('');
	})

	.done(function(data) {
		for(var i=0;i<data.length;i++) {
			var busqueda = $('<p>').text(data[i]);
			$('#ultimas_busquedas').append(busqueda);
		}
	})
}

$(document).ready(function(){
	$('#search').click(function(){
	    show_results($('#name_song').val());
	    $('#load').show();
	    $('#messages').html('');
	    $('#messages').hide();
	});

	$('#load').hide();
	$('#messages').hide();

	setInterval(function() {
	      show_recent_searchs();
	}, 5000);
});
</script>

<script src="{{STATIC_URL}}js/bootstrap.min.js"></script>
</body>
</html>